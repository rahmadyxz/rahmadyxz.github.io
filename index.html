<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Happy Birthday üíñ</title>
  <style>
    :root{
      --bg1:#0b1020;
      --bg2:#1a1033;
      --card: rgba(255,255,255,.08);
      --stroke: rgba(255,255,255,.16);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);
      --accent1:#ff5ea8;
      --accent2:#8a5cff;
      --shadow: 0 20px 60px rgba(0,0,0,.45);
      --radius: 22px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 20% 10%, rgba(255,94,168,.18), transparent 60%),
        radial-gradient(900px 700px at 80% 20%, rgba(138,92,255,.22), transparent 60%),
        radial-gradient(900px 700px at 50% 90%, rgba(255,255,255,.06), transparent 60%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }

    .wrap{
      min-height:100%;
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:28px 16px 60px;
      gap:18px;
      position:relative;
      z-index:2; /* di atas fireworks */
    }

    /* floating hearts (background) */
    .hearts{position:absolute; inset:0; pointer-events:none; overflow:hidden;}
    .heart{
      position:absolute;
      width:14px; height:14px;
      transform: rotate(45deg);
      opacity:.45;
      filter: blur(.2px);
      animation: floatUp linear infinite;
      background: linear-gradient(135deg, var(--accent1), var(--accent2));
    }
    .heart::before,.heart::after{
      content:"";
      position:absolute;
      width:14px;height:14px;border-radius:50%;
      background: inherit;
    }
    .heart::before{left:-7px; top:0}
    .heart::after{left:0; top:-7px}
    @keyframes floatUp{
      from{transform: translateY(20vh) rotate(45deg); opacity:0}
      10%{opacity:.55}
      to{transform: translateY(-120vh) rotate(45deg); opacity:0}
    }

    header{
      width:min(980px, 100%);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:14px 16px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      backdrop-filter: blur(10px);
      border-radius: 999px;
      box-shadow: 0 8px 30px rgba(0,0,0,.22);
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:700; letter-spacing:.2px;
    }
    .dot{
      width:12px;height:12px;border-radius:50%;
      background: radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,.2) 35%, transparent 60%),
                  linear-gradient(135deg, var(--accent1), var(--accent2));
      box-shadow: 0 0 18px rgba(255,94,168,.35);
    }
    .mini{color:var(--muted);font-size:13px;line-height:1.2}
    .pill{
      display:flex; gap:10px; align-items:center;
      color:var(--muted);
      font-size:13px;
    }
    .pill b{color:var(--text)}
    .sep{opacity:.4}

    main{
      width:min(980px, 100%);
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:18px;
      margin-top:8px;
    }
    @media (max-width:860px){
      main{grid-template-columns:1fr}
    }

    .card{
      border:1px solid var(--stroke);
      background: var(--card);
      backdrop-filter: blur(12px);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .card .pad{padding:22px}

    .hero{
      min-height: 330px;
      display:flex;
      align-items:stretch;
      position:relative;
    }
    .hero::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(900px 400px at 30% 20%, rgba(255,94,168,.24), transparent 55%),
        radial-gradient(700px 400px at 80% 30%, rgba(138,92,255,.28), transparent 55%),
        radial-gradient(700px 500px at 60% 90%, rgba(255,255,255,.07), transparent 60%);
      pointer-events:none;
    }
    .hero .content{
      position:relative;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:12px;
      padding:26px;
      flex:1;
    }

    /* ‚úÖ GIF row 1 baris (Tenor) */
.heroAnim{
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:flex-start;   /* mulai dari kiri */
  width:100%;
  margin: -2px 0 8px;          /* posisi di atas dalam card */
}

.gifAnim{
  width:56px;                  /* ukuran per gif (bisa 52-64) */
  height:56px;
  flex: 0 0 auto;              /* jangan melebar */
  object-fit:cover;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.14);
  filter: drop-shadow(0 10px 22px rgba(0,0,0,.30));
  opacity:.95;
}

/* kalau gif kepanjangan di HP kecil, biar tetep 1 baris & bisa geser halus */
.heroAnim{
  overflow-x:auto;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
}
.heroAnim::-webkit-scrollbar{display:none;}


    h1{
      margin:0;
      font-size: clamp(26px, 4.2vw, 44px);
      line-height:1.05;
      letter-spacing:-.6px;
    }
    .subtitle{
      margin:0;
      color: var(--muted);
      font-size:15px;
      max-width: 55ch;
    }
    .chips{display:flex; flex-wrap:wrap; gap:8px; margin-top:4px;}
    .chip{
      font-size:12px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.12);
      color: rgba(255,255,255,.82);
      cursor: default;
    }

    .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;}
    button, a.btn{
      border:0;
      cursor:pointer;
      padding:12px 14px;
      border-radius: 14px;
      font-weight:700;
      letter-spacing:.2px;
      transition: transform .12s ease, filter .12s ease, background .12s ease;
      display:inline-flex;
      align-items:center;
      gap:10px;
      text-decoration:none;
      color: var(--text);
    }
    button:active, a.btn:active{transform: translateY(1px) scale(.99)}
    .primary{
      background: linear-gradient(135deg, var(--accent1), var(--accent2));
      box-shadow: 0 12px 28px rgba(138,92,255,.20);
    }
    .ghost{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.16);
    }
    .tiny{font-size:12px;color: var(--muted);margin-top:8px;}

    .side{display:grid; gap:18px; align-content:start;}

    /* ‚úÖ FEED FOTO DI INDEX (IG STYLE 1:1) */
    .feedWrap{
      width:min(980px, 100%);
      margin-top: 6px;
    }
    .feedTitle{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:12px;
      margin: 8px 2px 10px;
    }
    .feedTitle h2{
      margin:0;
      font-size:16px;
      letter-spacing:.2px;
    }
    .feedTitle span{
      font-size:12px;
      color: rgba(255,255,255,.62);
    }
    .feedGrid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
    }
    @media (max-width:520px){
      .feedGrid{gap:8px}
    }
    .feedItem{
      width:100%;
      aspect-ratio: 1 / 1;
      border-radius: 16px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.14);
      position:relative;
      box-shadow: 0 14px 40px rgba(0,0,0,.22);
      transform: translateZ(0);
    }
    .feedItem img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      transform: scale(1.01);
      transition: transform .18s ease, filter .18s ease;
      will-change: transform;
    }
    .feedItem:active img{ transform: scale(.98); }
    .feedItem:hover img{ filter: brightness(1.05); transform: scale(1.04); }
    .feedCap{
      position:absolute;
      left:10px; right:10px; bottom:10px;
      font-size:11px;
      color: rgba(255,255,255,.86);
      text-shadow: 0 8px 18px rgba(0,0,0,.55);
      opacity:0;
      transform: translateY(6px);
      transition: .18s ease;
      pointer-events:none;
    }
    .feedItem:hover .feedCap{ opacity:1; transform: translateY(0); }

    /* overlay (generic) */
    .overlay{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(8px);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:50;
    }
    .overlay.show{display:flex}
    .modal{
      width:min(760px, 100%);
      border-radius: 24px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(20,16,40,.78);
      box-shadow: 0 30px 90px rgba(0,0,0,.6);
      overflow:hidden;
      position:relative;
    }
    .modal header{
      width:100%;
      border-radius:0;
      border:0;
      border-bottom:1px solid rgba(255,255,255,.12);
      box-shadow:none;
      background: rgba(255,255,255,.04);
    }
    .modal .content{padding:22px 18px 18px}
    .letter{
      line-height:1.75;
      color: rgba(255,255,255,.88);
      font-size: 15px;
      white-space:pre-wrap;
      cursor: pointer;
    }
    .modal .footer{
      display:flex; gap:10px; justify-content:flex-end;
      padding: 0 18px 18px;
    }

    footer{
      width:min(980px, 100%);
      color: rgba(255,255,255,.55);
      font-size:12px;
      text-align:center;
      margin-top:auto;
      padding-top:12px;
    }

    /* ‚úÖ FIREWORKS CANVAS: jadi background index (di belakang konten) */
    canvas#confetti{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:0;          /* di belakang */
      opacity:1;
    }

    /* =========================
       ‚úÖ GATE overlay
       ========================= */
    .gate{
      position: fixed;
      inset: 0;
      z-index: 9999;
      display:none;
    }
    .gate.show{display:block}

    .gateBackdrop{
  position:absolute;
  inset:0;
  background:
    radial-gradient(1200px 600px at 20% 10%, rgba(255,94,168,.35), transparent 60%),
    radial-gradient(900px 600px at 80% 20%, rgba(138,92,255,.45), transparent 60%),
    linear-gradient(160deg, #0b1020, #1a1033);
}

    /* blur konten index */
    body.gated > .wrap{
      filter: blur(10px);
      pointer-events:none;
      user-select:none;
    }

    .gateCard{
      position:relative;
      width: min(560px, calc(100% - 32px));
      margin: 8vh auto 0;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      box-shadow: 0 30px 90px rgba(0,0,0,.55);
      padding: 18px;
      color: rgba(255,255,255,.92);
    }

    .gateTop{
      display:flex; align-items:center; gap:12px;
      padding: 6px 6px 14px;
    }
    .gateDot{
      width:12px;height:12px;border-radius:50%;
      background: radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,.2) 35%, transparent 60%),
                  linear-gradient(135deg, var(--accent1), var(--accent2));
      box-shadow: 0 0 18px rgba(255,94,168,.35);
    }
    .gateTitle{font-weight:900; letter-spacing:.2px}
    .gateSub{font-size:13px; color: rgba(255,255,255,.70); margin-top:2px}

    .gateBody{padding: 4px 6px 8px}
    .gateText{margin:0 0 14px; color: rgba(255,255,255,.78); line-height:1.45}

    /* tombol play model pill */
    .gateBtn{
      width:100%;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      padding: 12px 14px;
      border-radius: 999px;
      font-weight: 800;
      cursor:pointer;
      transition: transform .12s ease, filter .12s ease, box-shadow .2s ease, opacity .2s ease;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .gateBtn:hover{filter: brightness(1.06)}
    .gateBtn:active{transform: scale(.99)}
    .gateBtn.primary{
      border:0;
      background: linear-gradient(135deg, var(--accent1), var(--accent2));
      box-shadow: 0 12px 28px rgba(138,92,255,.20);
    }

    /* disabled gate button */
    .gateBtn.disabled{
      opacity:.55;
      cursor:not-allowed;
      filter: grayscale(.2);
      box-shadow:none;
    }

    .gateHint{
      margin-top:10px;
      font-size:12px;
      color: rgba(255,255,255,.60);
      text-align:center;
    }

    /* reveal animation */
    .gateBody, .gateReveal{transition: opacity .45s ease, transform .55s ease;}
    .gateBody.hiding{opacity:0; transform: translateY(-6px); pointer-events:none;}
    .gateReveal{padding: 4px 6px 10px; opacity:0; transform: translateY(10px);}
    .gateReveal.hidden{display:none}
    .gateReveal.showing{opacity:1; transform: translateY(0);}

    .gateMedia{
      border-radius: 18px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.12);
      display:flex;
      justify-content:center;
      align-items:center;
      position:relative;
      isolation:isolate;
    }
    /* Foto ikut ukuran asli (tetap aman di layar) */
    .gateMedia img{
      width:auto;
      height:auto;
      max-width:92vw;
      max-height:52vh;
      object-fit:contain;
      display:block;
      position:relative;
      z-index:1;
    }

    /* Love tiny anim on photo */
    .loveLayer{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index:2;
      opacity:0;
      transition: opacity .35s ease;
    }
    .gateMedia.loving .loveLayer{opacity:1}
    .tinyLove{
      position:absolute;
      width:10px; height:10px;
      transform: rotate(45deg);
      background: linear-gradient(135deg, rgba(255,94,168,.95), rgba(138,92,255,.95));
      opacity:.0;
      filter: drop-shadow(0 6px 12px rgba(0,0,0,.28));
      animation: loveFloat 1.8s ease-in-out infinite;
      border-radius: 2px;
    }
    .tinyLove::before,.tinyLove::after{
      content:"";
      position:absolute;
      width:10px; height:10px;
      border-radius:50%;
      background: inherit;
    }
    .tinyLove::before{left:-5px; top:0}
    .tinyLove::after{left:0; top:-5px}
    @keyframes loveFloat{
      0%{ transform: translateY(10px) rotate(45deg) scale(.9); opacity:0}
      20%{opacity:.55}
      50%{ transform: translateY(-6px) rotate(45deg) scale(1.05); opacity:.65}
      80%{opacity:.35}
      100%{ transform: translateY(10px) rotate(45deg) scale(.92); opacity:0}
    }

    .gateMsg{margin-top:12px}
    .gateMsgTitle{font-weight:900}
    .gateMsgText{
      margin-top:6px;
      font-size:13px;
      color: rgba(255,255,255,.78);
      line-height:1.45;
      min-height: 3.2em;
    }

    .gateActions{display:flex; gap:10px; margin-top:12px;}
    .gateActions .gateBtn{width:auto; flex:1}

    /* music wiggle */
    .musicIcon{display:inline-block; transform-origin:center;}
    .gateBtn.on{box-shadow: 0 12px 28px rgba(255,94,168,.14);}
    .gateBtn.on .musicIcon{
      animation: wiggle .9s ease-in-out infinite;
      filter: drop-shadow(0 0 10px rgba(138,92,255,.25));
    }
    @keyframes wiggle{
      0%,100%{transform: rotate(-8deg) scale(1.02)}
      50%{transform: rotate(8deg) scale(1.02)}
    }

    /* typing caret */
    .caret{
      display:inline-block;
      width: 8px;
      margin-left: 2px;
      opacity:.9;
      transform: translateY(1px);
      animation: blink 0.9s steps(1) infinite;
    }
    @keyframes blink{
      0%,49%{opacity:1}
      50%,100%{opacity:0}
    }

    /* gate countdown block (di bawah tombol) */
    .gateCount{
      margin-top:14px;
      padding: 12px 12px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.10);
    }
    .gateCountTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      color: rgba(255,255,255,.78);
      font-size:12px;
      margin-bottom:8px;
    }
    .gateCountTop b{color: rgba(255,255,255,.92)}
    .gateCountGrid{
      display:flex;
      gap:10px;
      justify-content:space-between;
    }
    .gBox{
      flex:1;
      text-align:center;
      padding:10px 8px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.12);
    }
    .gNum{font-size:20px;font-weight:900}
    .gLbl{margin-top:2px;font-size:11px;color: rgba(255,255,255,.65)}

    /* ===== Gate exit animation ===== */
    .gate.exiting .gateBackdrop{ animation: gateFadeBackdrop .75s ease forwards; }
    .gate.exiting .gateCard{ animation: gateFadeCard .75s ease forwards; }
    @keyframes gateFadeBackdrop{ from{opacity:1} to{opacity:0} }
    @keyframes gateFadeCard{
      from{opacity:1; transform: translateY(0) scale(1)}
      to{opacity:0; transform: translateY(16px) scale(.98)}
    }

    /* =========================
       ‚úÖ Popup dalam popup (lock alert)
       ========================= */
    .miniPop{
      position:absolute;
      left:50%;
      top:18px;
      transform: translateX(-50%);
      width: min(520px, calc(100% - 18px));
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(20,16,40,.88);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      box-shadow: 0 22px 70px rgba(0,0,0,.55);
      padding: 12px 12px;
      z-index: 10000;
      display:none;
      opacity:0;
    }
    .miniPop.show{
      display:block;
      animation: popIn .25s ease forwards;
    }
    @keyframes popIn{
      from{opacity:0; transform: translateX(-50%) translateY(-6px) scale(.98)}
      to{opacity:1; transform: translateX(-50%) translateY(0) scale(1)}
    }
    .miniPopRow{
      display:flex; gap:10px; align-items:flex-start;
    }
    .miniIcon{
      width:34px;height:34px;border-radius:12px;
      display:grid;place-items:center;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      flex:0 0 auto;
    }
    .miniTitle{font-weight:900}
    .miniText{margin-top:2px;font-size:13px;color: rgba(255,255,255,.75);line-height:1.35}
    .miniActions{
      display:flex; gap:10px; justify-content:flex-end;
      margin-top:10px;
    }
    .miniBtn{
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      padding:10px 12px;
      border-radius: 999px;
      font-weight:800;
      cursor:pointer;
    }
    .miniBtn.primary{
      border:0;
      background: linear-gradient(135deg, var(--accent1), var(--accent2));
      box-shadow: 0 12px 28px rgba(138,92,255,.18);
    }
  </style>
</head>

<body>
  <!-- ‚úÖ fireworks background -->
  <canvas id="confetti"></canvas>

  <!-- ‚úÖ GATE overlay -->
  <div id="gate" class="gate show" aria-hidden="false">
    <div class="gateBackdrop"></div>

    <div class="gateCard" role="dialog" aria-modal="true" aria-label="Surat sebelum masuk">

      <!-- ‚úÖ mini popup dalam popup -->
      <div id="gateAlert" class="miniPop" aria-live="polite">
        <div class="miniPopRow">
          <div class="miniIcon">ü§™</div>
          <div style="flex:1">
            <div class="miniTitle">Eits tunggu dulu‚Ä¶</div>
            <div class="miniText" id="gateAlertText">
              Hanya bisa dibuka pada saat kamu ulang tahun.
            </div>
          </div>
        </div>
        <div class="miniActions">
          <button class="miniBtn" id="gateAlertClose" type="button">Oke</button>
          <button class="miniBtn primary" id="gateAlertOk" type="button">Siap üòù</button>
        </div>
      </div>

      <div class="gateTop">
        <div class="gateDot"></div>
        <div>
          <div class="gateTitle">Buat kamu üíå</div>
          <div class="gateSub">Buka dulu ya sebelum masuk üòã</div>
        </div>
      </div>

      <div id="gateBody" class="gateBody">
        <p class="gateText">
          Ada pesan kecil buat kamu. Klik tombol di bawah ya üòä
        </p>

        <button id="gateOpen" class="gateBtn primary" type="button">
          Buka pesannya ‚ú® <span class="musicIcon">üéµ</span>
        </button>

        <!-- ‚úÖ COUNTDOWN DI BAWAH GATE -->
        <div class="gateCount" aria-label="Countdown">
          <div class="gateCountTop">
            <span id="gateCountLabel">Hitungan Mundur Menuju</span>
            <b id="gateCountDate">‚Äî</b>
          </div>
          <div class="gateCountGrid">
            <div class="gBox"><div class="gNum" id="gD">0</div><div class="gLbl" id="gDL">Hari</div></div>
            <div class="gBox"><div class="gNum" id="gH">00</div><div class="gLbl" id="gHL">Jam</div></div>
            <div class="gBox"><div class="gNum" id="gM">00</div><div class="gLbl" id="gML">Menit</div></div>
            <div class="gBox"><div class="gNum" id="gS">00</div><div class="gLbl" id="gSL">Detik</div></div>
          </div>
          <div class="gateHint" id="gateCountNote" style="margin-top:8px"></div>
        </div>

        <div class="gateHint" style="margin-top:12px">
          Made with love üíó @rahmadyxz
        </div>
      </div>

      <div id="gateReveal" class="gateReveal hidden">
        <div class="gateMedia" id="gateMedia">
          <img id="gateImg" src="images/cover.jpg" alt="Foto" />
          <div class="loveLayer" id="loveLayer"></div>
        </div>

        <div class="gateMsg">
          <div class="gateMsgTitle">Happy birthday ü§ç</div>
          <div class="gateMsgText" id="gateText"></div>
        </div>

        <div class="gateActions">
          <button id="gateSkip" class="gateBtn" type="button">Skip (masuk sekarang)</button>
          <button id="gateReplay" class="gateBtn" type="button">Ulang lagu üéµ</button>
        </div>

        <div class="gateHint">Tunggu sampai lagunya habis ya ^_^</div>
        <div class="gateHint">Made with love üíó @rahmadyxz</div>
      </div>
    </div>
  </div>

  <!-- ‚úÖ AUDIO untuk gate (pake file lokal) -->
  <audio id="bgm" preload="auto">
    <source src="birthday.mp3" type="audio/mpeg" />
  </audio>

  <!-- ‚úÖ AUDIO untuk index (lagu kedua / atau bisa sama file juga) -->
  <audio id="bgmIndex" preload="auto" loop>
    <source src="birthday.mp3" type="audio/mpeg" />
  </audio>

  <div class="wrap">
    <div class="hearts" id="hearts"></div>

    <header>
      <div class="brand">
        <span class="dot"></span>
        <div>
          <div>Untuk <span id="nameTop">Doi Kamu</span> üíñ</div>
          <div class="mini" id="dateTop">‚Äî</div>
        </div>
      </div>
      <div class="pill">
        <span><b id="fromTop"></b></span>
        <span class="sep"></span>
        <span class="mini" id="tagline">‚Äúsemoga kamu selalu bahagia‚Äù</span>
      </div>
    </header>

    <main>
      <section class="card hero">
        <div class="content">
          <!-- ‚úÖ GIF Tenor (ganti URL-nya sesuai GIF lu) -->
          <div class="heroAnim" aria-label="gif row">
  <img class="gifAnim" src="https://media.tenor.com/RGsJYjA5gOsAAAAj/peach-goma.gif" alt="gif 1" loading="lazy" decoding="async" />
  <img class="gifAnim" src="https://media.tenor.com/EjH1sk7bSv4AAAAi/peach-goma-hearts-bucket.gif" alt="gif 2" loading="lazy" decoding="async" />
  <img class="gifAnim" src="https://media.tenor.com/v63_brUy45wAAAAj/peach-goma-love-peach-cat.gif" alt="gif 3" loading="lazy" decoding="async" />
  <img class="gifAnim" src="https://media.tenor.com/6uHiHBHG22wAAAAj/peach-and-goma.gif" alt="gif 4" loading="lazy" decoding="async" />
  <img class="gifAnim" src="https://media.tenor.com/nBQQ6XM5BhIAAAAj/cute.gif" alt="gif 5" loading="lazy" decoding="async" />
  <img class="gifAnim" src="https://media.tenor.com/TMl58EiFm1IAAAAj/cute.gif" alt="gif 6" loading="lazy" decoding="async" />
  <img class="gifAnim" src="https://media.tenor.com/GgOmrYFNGMcAAAAj/peach-goma.gif" alt="gif 7" loading="lazy" decoding="async" />
  <img class="gifAnim" src="https://media.tenor.com/A5VhCveZ_ygAAAAj/peach-and-goma-peach-goma.gif" alt="gif 8" loading="lazy" decoding="async" />
</div>

          <h1>
            Happy Birthday,<br />
            <span id="nameHero">Imelia Rinjani Az-Zahra</span> ‚ú®
          </h1>
          <p class="subtitle" id="subtitle"></p>

          <div class="chips">
            <span class="chip">üéÇ Ulang tahun ke-<span id="ageChip">?</span></span>
            <span class="chip">üíå Ada surat kecil</span>
            <span class="chip">üì∏ Ada foto kita</span>
          </div>

          <div class="actions">
            <button class="primary" id="openLetter">Buka surat üíå</button>
            <!-- ‚úÖ BIARIN: ini buat pindah ke page memories -->
            <a class="btn ghost" href="memories.html">Lihat foto üì∑</a>
            <a class="btn ghost" href="video.html">Lihat video üì∑</a>
          </div>

          <div class="tiny">
            Catatan: Buka 1/1 yaa hehe.
          </div>
        </div>
      </section>

      <aside class="side">
        <section class="card" id="wishes">
          <div class="pad">
            <h2 style="margin:0 0 6px 0; font-size:18px;">Harapan aku buat kamu</h2>
            <ul id="wishList" style="margin:10px 0 0 18px; color:var(--muted); line-height:1.7;">
  <li data-text="Semoga sehat, tenang, dan makin sayang sama diri sendiri."></li>
  <li data-text="Semoga yang kamu usahain pelan-pelan jadi nyata."></li>
  <li data-text="Semoga kita bisa ketawa bareng lebih sering."></li>
</ul>
          </div>
        </section>
      </aside>
    </main>

    <!-- ‚úÖ FEED FOTO DI INDEX -->
    <section class="feedWrap">
      <div class="feedTitle">
        <h2>Foto üì∏</h2>
      </div>

      <div class="feedGrid" id="feedGrid">
        <div class="feedItem"><img src="images/f1.jpg" alt="foto 1" loading="lazy" decoding="async"><div class="feedCap">ü§ç</div></div>
        <div class="feedItem"><img src="images/f2.jpg" alt="foto 2" loading="lazy" decoding="async"><div class="feedCap">üíú</div></div>
        <div class="feedItem"><img src="images/f3.jpg" alt="foto 3" loading="lazy" decoding="async"><div class="feedCap">üíó</div></div>
        <div class="feedItem"><img src="images/f4.jpg" alt="foto 4" loading="lazy" decoding="async"><div class="feedCap">‚ú®</div></div>
        <div class="feedItem"><img src="images/f5.jpg" alt="foto 5" loading="lazy" decoding="async"><div class="feedCap">ü´∂</div></div>
        <div class="feedItem"><img src="images/f6.jpg" alt="foto 6" loading="lazy" decoding="async"><div class="feedCap">üéÇ</div></div>
      </div>
    </section>

    <footer>Made with love üíó @rahmadyxz</footer>
  </div>

  <!-- Letter Modal -->
  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Surat ulang tahun">
      <header>
        <div class="brand">
          <span class="dot"></span>
          <div>
            <div>Surat buat <span id="nameLetter">Imelia Rinjani Az-Zahra</span></div>
            <div class="mini" id="dateLetter">‚Äî</div>
          </div>
        </div>
      </header>

      <div class="content">
        <div class="letter" id="letterText" title="Tap untuk skip typing"></div>
      </div>

      <div class="footer">
        <button class="ghost" id="closeLetter" style="border-radius:999px; padding:10px 12px;">Tutup ‚úñ</button>
      </div>
    </div>
  </div>

  <script>
    /** ====== EDIT BAGIAN INI ====== */
    const CONFIG = {
      toName: "Imelia Rinjani Az-Zahra",
      fromName: "",
      tagline: "‚Äúhappy birthday, my favorite person.‚Äù",
      birthday: "2026-01-17", // full date
      age: "18",
      subtitle:
        "Hari ini bukan cuma ulang tahun kamu‚Äîini hari spesial yang bikin dunia jadi sedikit lebih manis. Aku bikin halaman kecil ini biar kamu bisa senyum setiap kali buka.",
      letter:
`Hai kamu üíñ

Selamat ulang tahun ya. Makasih udah jadi kamu‚Äîyang kadang cerewet, kadang lucu, tapi selalu bikin aku ngerasa ‚Äúrumah‚Äù.
Semoga di umur baru ini kamu makin bahagia, makin kuat, dan makin dikelilingi hal-hal baik.

Aku bangga sama kamu.
Dan aku sayang kamu, banyak. üíñ

‚Äî @rahmadyxz`,

      gateMessage:
        "Semoga hari ini kamu senyum terus ya. Aku bangga sama kamu. üíñ",

      // Musik gate
      musicVolume: 0.55,
      musicFadeInMs: 1200,

      // Musik index (lagu kedua)
      indexMusicVolume: 0.55,
      indexMusicFadeInMs: 1400,

      // Typing
      typingSpeedMs: 28,
      typingRandomJitter: 22,
      typingStartDelayMs: 240,

      // Typing surat
      letterTypingSpeedMs: 18,
      letterTypingJitter: 14,

      lockedMessage:
        "Hanya bisa dibuka pada saat kamu ulang tahun üíóü§ç"
    };
    /** =========================== */

    async function typeList(listEl, opts={}){
  const items = [...listEl.querySelectorAll("li")];
  const speed = opts.speedMs ?? 24;
  const jitter = opts.jitter ?? 14;

  for(const li of items){
    const text = li.dataset.text || "";
    li.textContent = "";
    for(let i=0;i<text.length;i++){
      li.textContent += text[i];
      await sleep(speed + Math.random()*jitter);
    }
    await sleep(240);
  }
}

    // ===== Helpers =====
    const fmtDateID = (d) => new Intl.DateTimeFormat("id-ID", { dateStyle:"long" }).format(d);
    const fmtWeekdayID = (d) => new Intl.DateTimeFormat("id-ID", { weekday:"long" }).format(d);
    const sleep = (ms) => new Promise(r => setTimeout(r, ms));
    const clamp = (v, a, b) => Math.max(a, Math.min(b, v));

    function parseISODateLocal(iso){
      const [y,m,d] = iso.split("-").map(Number);
      return new Date(y, (m||1)-1, d||1, 0,0,0,0);
    }
    function todayLocal(){
      const n = new Date();
      return new Date(n.getFullYear(), n.getMonth(), n.getDate(), 0,0,0,0);
    }
    function isUnlockedNow(iso){
      return todayLocal().getTime() >= parseISODateLocal(iso).getTime();
    }

    // ===== Gate elements =====
    const gate = document.getElementById("gate");
    const gateOpen = document.getElementById("gateOpen");
    const gateBody = document.getElementById("gateBody");
    const gateReveal = document.getElementById("gateReveal");
    const gateSkip = document.getElementById("gateSkip");
    const gateReplay = document.getElementById("gateReplay");
    const gateTextEl = document.getElementById("gateText");
    const bgm = document.getElementById("bgm");
    const bgmIndex = document.getElementById("bgmIndex");
    const gateMedia = document.getElementById("gateMedia");
    const loveLayer = document.getElementById("loveLayer");

    // gate countdown elements
    const gateCountLabel = document.getElementById("gateCountLabel");
    const gateCountDate = document.getElementById("gateCountDate");
    const gateCountNote = document.getElementById("gateCountNote");
    const gD = document.getElementById("gD");
    const gH = document.getElementById("gH");
    const gM = document.getElementById("gM");
    const gS = document.getElementById("gS");
    const gDL = document.getElementById("gDL");
    const gHL = document.getElementById("gHL");
    const gML = document.getElementById("gML");
    const gSL = document.getElementById("gSL");

    // mini popup (lock alert)
    const gateAlert = document.getElementById("gateAlert");
    const gateAlertText = document.getElementById("gateAlertText");
    const gateAlertClose = document.getElementById("gateAlertClose");
    const gateAlertOk = document.getElementById("gateAlertOk");

    // start gated
    document.body.classList.add("gated");
    bgm.volume = 0;
    bgmIndex.volume = 0;

    // ===== Volume fade =====
    function fadeVolumeEl(audioEl, target=0.55, ms=1200){
      const start = audioEl.volume;
      const delta = target - start;
      const t0 = performance.now();
      function step(t){
        const p = Math.min((t - t0) / ms, 1);
        const ease = 1 - Math.pow(1 - p, 3);
        audioEl.volume = clamp(start + delta * ease, 0, 1);
        if(p < 1) requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }

    // ===== Typing effect =====
    let typingAbort = { stop:false };
    function stopTyping(){ typingAbort.stop = true; }

    async function typeText(el, text, opts){
      typingAbort.stop = false;
      const speed = opts.speedMs ?? 28;
      const jitter = opts.jitter ?? 18;

      el.innerHTML = "";
      const txt = document.createElement("span");
      txt.className = "txt";
      const caret = document.createElement("span");
      caret.className = "caret";
      caret.textContent = "‚ñç";
      el.appendChild(txt);
      el.appendChild(caret);

      for(let i=0;i<text.length;i++){
        if(typingAbort.stop) break;
        txt.textContent += text[i];
        await sleep(speed + Math.random()*jitter);
      }

      await sleep(180);
      if(caret.isConnected){
        caret.style.animation = "none";
        caret.style.opacity = "0";
        await sleep(120);
        caret.remove();
      }

      if(typingAbort.stop) txt.textContent = text;
    }

    gateTextEl.addEventListener("click", () => {
      stopTyping();
      const span = gateTextEl.querySelector(".txt");
      if(span) span.textContent = CONFIG.gateMessage;
      else gateTextEl.textContent = CONFIG.gateMessage;
    });

    // ===== Love overlay on photo =====
    function buildLove(){
      loveLayer.innerHTML = "";
      const n = 12;
      for(let i=0;i<n;i++){
        const h = document.createElement("div");
        h.className = "tinyLove";
        h.style.left = (10 + Math.random()*80) + "%";
        h.style.top  = (10 + Math.random()*70) + "%";
        const d = 1.4 + Math.random()*1.6;
        const delay = Math.random()*0.9;
        const size = 8 + Math.random()*8;
        h.style.width = size + "px";
        h.style.height = size + "px";
        h.style.animationDuration = d + "s";
        h.style.animationDelay = delay + "s";
        loveLayer.appendChild(h);
      }
    }
    buildLove();
    function setLoving(on){
      gateMedia.classList.toggle("loving", !!on);
      if(on) buildLove();
    }

    // ===== Locked popup in gate =====
    function showGateAlert(msg){
      gateAlertText.textContent = msg || CONFIG.lockedMessage;
      gateAlert.classList.add("show");
      clearTimeout(showGateAlert._t);
      showGateAlert._t = setTimeout(() => {
        gateAlert.classList.remove("show");
      }, 3200);
    }
    gateAlertClose.addEventListener("click", () => gateAlert.classList.remove("show"));
    gateAlertOk.addEventListener("click", () => gateAlert.classList.remove("show"));

    // ===== Gate unlock logic =====
    function setGateButtonState(){
      const allowed = isUnlockedNow(CONFIG.birthday);
      if(allowed){
        gateOpen.classList.remove("disabled");
        gateOpen.disabled = false;
        gateOpen.title = "";
      } else {
        gateOpen.classList.add("disabled");
        gateOpen.disabled = false; // masih bisa diklik utk munculin popup
        gateOpen.title = "Belum bisa dibuka";
      }
      return allowed;
    }

    // ===== Countdown -> lewat tanggal langsung stop jadi statis =====
    const targetDate = parseISODateLocal(CONFIG.birthday);
    gateCountDate.textContent = fmtDateID(targetDate);

    function renderStaticDateInfo(){
      gateCountLabel.textContent = "Tanggal Spesial";
      gateCountDate.textContent = fmtDateID(targetDate);

      const dd = String(targetDate.getDate()).padStart(2,"0");
      const mm = String(targetDate.getMonth()+1).padStart(2,"0");
      const yyyy = String(targetDate.getFullYear());

      gD.textContent = dd;   gDL.textContent = "Tanggal";
      gH.textContent = mm;   gHL.textContent = "Bulan";
      gM.textContent = yyyy; gML.textContent = "Tahun";
      gS.textContent = fmtWeekdayID(targetDate); gSL.textContent = "Hari";
    }

    let gateCountdownTimer = 0;
    function tickGateCountdown(){
      const now = new Date();
      const unlocked = todayLocal().getTime() >= targetDate.getTime();

      if(unlocked){
        renderStaticDateInfo();
        gateCountNote.textContent = "Sekarang udah waktunya üéÇ Silakan dibuka ü§ç";
        setGateButtonState();
        if(gateCountdownTimer){
          clearInterval(gateCountdownTimer);
          gateCountdownTimer = 0;
        }
        return;
      }

      // sebelum tanggal -> countdown normal
      gateCountLabel.textContent = "Hitungan Mundur Menuju";
      gateCountDate.textContent = fmtDateID(targetDate);
      gateCountNote.textContent = "";

      const diff = Math.max(0, targetDate.getTime() - now.getTime());
      const days = Math.floor(diff / (1000*60*60*24));
      const hours = Math.floor((diff / (1000*60*60)) % 24);
      const mins = Math.floor((diff / (1000*60)) % 60);
      const secs = Math.floor((diff / 1000) % 60);

      gD.textContent = String(days);  gDL.textContent = "Hari";
      gH.textContent = String(hours).padStart(2,"0"); gHL.textContent = "Jam";
      gM.textContent = String(mins).padStart(2,"0");  gML.textContent = "Menit";
      gS.textContent = String(secs).padStart(2,"0");  gSL.textContent = "Detik";

      setGateButtonState();
    }
    tickGateCountdown();
    gateCountdownTimer = setInterval(tickGateCountdown, 1000);

    // ===== Music control =====
    async function playGateMusicFromStart(btn){
      try { bgm.currentTime = 0; } catch(e){}
      try{
        await bgm.play();
        if(btn) btn.classList.add("on");
        fadeVolumeEl(bgm, CONFIG.musicVolume ?? 0.55, CONFIG.musicFadeInMs || 1200);
      }catch(err){
        if(btn) btn.classList.remove("on");
        alert("Browser ngeblok autoplay üòÑ Klik tombolnya sekali lagi ya.");
        throw err;
      }
    }

    // üëâ penting: supaya lagu index bisa nyala otomatis pas gate ilang,
    // kita "prime" dulu saat user tap (gateOpen / gateSkip)
    let indexPrimed = false;
    async function primeIndexBgm(){
      if(indexPrimed) return true;
      try{
        bgmIndex.pause();
        bgmIndex.currentTime = 0;
      }catch(e){}
      bgmIndex.volume = 0;
      try{
        await bgmIndex.play();  // start muted (dianggap sudah ada user gesture)
        indexPrimed = true;
        return true;
      }catch(e){
        indexPrimed = false;
        return false;
      }
    }

    function startIndexBgmNow(){
      if(!indexPrimed) return; // kalau ga keprime ya ga maksa
      try{ bgmIndex.currentTime = 0; }catch(e){}
      fadeVolumeEl(bgmIndex, CONFIG.indexMusicVolume ?? 0.55, CONFIG.indexMusicFadeInMs || 1400);
    }

    // ===== Close gate -> baru mulai fireworks + lagu index =====
    let enteredIndexOnce = false;
    function closeGate(){
      gate.classList.add("exiting");
      setTimeout(() => {
        gate.classList.remove("show");
        gate.classList.remove("exiting");
        gate.setAttribute("aria-hidden", "true");
        document.body.classList.remove("gated");
        typeList(document.getElementById("wishList"), {
  speedMs: 24,
  jitter: 14
});

        if(!enteredIndexOnce){
          enteredIndexOnce = true;

          // üî• ini inti yang lu mau:
          // fireworks baru start setelah gate bener-bener hilang (masuk index)
          startFireworksLoop();
          // lagu index juga start barengan fireworks (kalau udah keprime)
          startIndexBgmNow();
        }
      }, 780);
    }

    // ===== Gate Open Click =====
    gateOpen.addEventListener("click", async () => {
      const allowed = isUnlockedNow(CONFIG.birthday);
      if(!allowed){
        showGateAlert(CONFIG.lockedMessage);
        return;
      }

      // prime lagu index biar nanti aman autoplay pas gate ilang
      await primeIndexBgm();

      // reveal animation
      gateBody.classList.add("hiding");
      gateReveal.classList.remove("hidden");
      void gateReveal.offsetHeight;
      gateReveal.classList.add("showing");
      setTimeout(() => { gateBody.style.display = "none"; }, 460);

      // photo love anim ON
      setLoving(true);

      // play music gate
      await playGateMusicFromStart(gateOpen);

      // typing
      gateTextEl.textContent = "";
      await sleep(CONFIG.typingStartDelayMs || 200);
      typeText(gateTextEl, CONFIG.gateMessage, {
        speedMs: CONFIG.typingSpeedMs,
        jitter: CONFIG.typingRandomJitter
      });

      // auto close when finished
      bgm.onended = () => {
        setLoving(false);
        closeGate();
      };
    });

    gateReplay.addEventListener("click", async () => {
      await playGateMusicFromStart(gateOpen);
    });

    gateSkip.addEventListener("click", async () => {
      await primeIndexBgm();
      stopTyping();
      setLoving(false);
      bgm.pause();
      closeGate();
    });

    // ===== Put config to UI =====
    const nameTop = document.getElementById("nameTop");
    const nameHero = document.getElementById("nameHero");
    const nameLetter = document.getElementById("nameLetter");
    const fromTop = document.getElementById("fromTop");
    const tagline = document.getElementById("tagline");
    const subtitle = document.getElementById("subtitle");
    const ageChip = document.getElementById("ageChip");
    const dateTop = document.getElementById("dateTop");
    const dateLetter = document.getElementById("dateLetter");

    nameTop.textContent = CONFIG.toName;
    nameHero.textContent = CONFIG.toName;
    nameLetter.textContent = CONFIG.toName;
    fromTop.textContent = CONFIG.fromName;
    tagline.textContent = CONFIG.tagline;
    subtitle.textContent = CONFIG.subtitle;
    ageChip.textContent = CONFIG.age;

    // header dates pakai tanggal config (bukan next year)
    dateTop.textContent = fmtDateID(targetDate);
    dateLetter.textContent = fmtDateID(targetDate);

    // ===== Hearts background =====
    const hearts = document.getElementById("hearts");
    function spawnHearts(){
      const n = 18;
      hearts.innerHTML = "";
      for(let i=0;i<n;i++){
        const el = document.createElement("div");
        el.className = "heart";
        const left = Math.random()*100;
        const dur = 6 + Math.random()*10;
        const delay = Math.random()*4;
        const size = 10 + Math.random()*14;
        el.style.left = left + "vw";
        el.style.bottom = (-20 - Math.random()*40) + "vh";
        el.style.animationDuration = dur + "s";
        el.style.animationDelay = delay + "s";
        el.style.width = size + "px";
        el.style.height = size + "px";
        hearts.appendChild(el);
      }
    }
    spawnHearts();

    // ===== Letter modal (typing) =====
    const overlay = document.getElementById("overlay");
    const letterText = document.getElementById("letterText");
    let letterTyping = false;

    document.getElementById("openLetter").addEventListener("click", async () => {
      overlay.classList.add("show");
      overlay.setAttribute("aria-hidden","false");

      // typing surat
      letterTyping = true;
      letterText.textContent = "";
      await sleep(120);
      typeText(letterText, CONFIG.letter, {
        speedMs: CONFIG.letterTypingSpeedMs,
        jitter: CONFIG.letterTypingJitter
      });
    });

    // tap untuk skip typing surat
    letterText.addEventListener("click", () => {
      if(!letterTyping) return;
      stopTyping();
      const span = letterText.querySelector(".txt");
      if(span) span.textContent = CONFIG.letter;
      else letterText.textContent = CONFIG.letter;
      letterTyping = false;
    });

    function closeModal(){
      overlay.classList.remove("show");
      overlay.setAttribute("aria-hidden","true");
      stopTyping();
      letterTyping = false;
      letterText.textContent = ""; // biar tiap buka ulang typing lagi
    }
    document.getElementById("closeLetter").addEventListener("click", closeModal);
    overlay.addEventListener("click", (e) => { if(e.target === overlay) closeModal(); });

    document.addEventListener("keydown", (e) => {
      if(e.key === "Escape"){
        closeModal();
        gateAlert.classList.remove("show");
      }
    });

    // ==========================
    // üî• FIREWORKS: ROCKET -> HEART BURST
    // Start ONLY after gate closed, and LOOP forever
    // ==========================
    const canvas = document.getElementById("confetti");
    const ctx = canvas.getContext("2d", { alpha:true });

    let DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1)); // cap DPR biar ga ngeframe
    let W = 0, H = 0;

    function resizeCanvas(){
      DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      W = window.innerWidth;
      H = window.innerHeight;
      canvas.width  = Math.floor(W * DPR);
      canvas.height = Math.floor(H * DPR);
      canvas.style.width = W + "px";
      canvas.style.height = H + "px";
      ctx.setTransform(DPR,0,0,DPR,0,0);
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    const isMobile = matchMedia("(max-width: 860px)").matches;
    const prefersReduced = matchMedia("(prefers-reduced-motion: reduce)").matches;
    const QUALITY = prefersReduced ? 0.0 : (isMobile ? 0.72 : 1.0);

    const rockets = [];
    const sparks = [];
    let fwRAF = 0;
    let fwLooping = false;

    function rand(min,max){ return min + Math.random()*(max-min); }
    function hsl(h,s,l,a=1){ return `hsla(${h} ${s}% ${l}% / ${a})`; }

    function heartPoints(count){
      const pts = [];
      for(let i=0;i<count;i++){
        const t = (i / count) * Math.PI * 2;
        const x = 16 * Math.pow(Math.sin(t),3);
        const y = 13*Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t);
        pts.push({x, y});
      }
      return pts;
    }
    const HEART = heartPoints(Math.floor(220 * QUALITY));

    function spawnRocket(){
      const x = rand(W*0.12, W*0.88);
      const y = H + 12;
      const peakY = rand(H*0.18, H*0.40);
      const hue = rand(0, 360);

      rockets.push({
        x, y,
        vx: rand(-0.8, 0.8),
        vy: rand(-13, -16) * (0.85 + 0.3*Math.random()),
        peakY,
        hue,
        trail: []
      });
    }

    function explodeHeart(rx, ry, hueBase){
      const scale = rand(3.2, 4.6);
      const burst = HEART.length;

      for(let i=0;i<burst;i++){
        const p = HEART[i];
        const dx = (p.x / 16) * scale;
        const dy = (-p.y / 16) * scale;

        const jitter = 0.15;
        const vx = dx * rand(2.1, 2.8) + rand(-jitter, jitter);
        const vy = dy * rand(2.1, 2.8) + rand(-jitter, jitter);

        const hue = (hueBase + rand(-30, 30) + (i/burst)*18) % 360;
        sparks.push({
          x: rx, y: ry,
          vx, vy,
          g: 0.085 + rand(0, 0.03),
          life: Math.floor(rand(52, 78)),
          hue,
          size: Math.max(0.9, rand(1.1, 2.1) * QUALITY),
          tw: rand(0.35, 0.9)
        });
      }
    }

    function startFireworksLoop(){
      if(prefersReduced) return;
      if(fwLooping) return;
      fwLooping = true;

      // langsung meriah pas masuk index
      const initial = Math.max(2, Math.floor(3 * QUALITY));
      for(let i=0;i<initial;i++) spawnRocket();

      if(!fwRAF) fwRAF = requestAnimationFrame(fwLoop);
    }

    function fwLoop(){
      fwRAF = requestAnimationFrame(fwLoop);

      // transparan biar nyatu sama background
      ctx.fillStyle = "rgba(0,0,0,0.10)";
      ctx.fillRect(0,0,W,H);

      // spawn roket terus (looping)
      const chance = 0.18 * QUALITY;
      if(Math.random() < chance) spawnRocket();

      // rockets
      for(let i=rockets.length-1;i>=0;i--){
        const r = rockets[i];
        r.x += r.vx;
        r.y += r.vy;
        r.vy += 0.06;

        r.trail.push({x:r.x, y:r.y});
        if(r.trail.length > Math.floor(14 * QUALITY)) r.trail.shift();

        for(let k=0;k<r.trail.length;k++){
          const p = r.trail[k];
          const a = (k / r.trail.length) * 0.85;
          ctx.fillStyle = hsl((r.hue + k*3)%360, 95, 70, a);
          ctx.fillRect(p.x, p.y, 2, 2);
        }

        ctx.fillStyle = hsl(r.hue, 100, 78, 0.95);
        ctx.beginPath();
        ctx.arc(r.x, r.y, 1.6, 0, Math.PI*2);
        ctx.fill();

        if(r.y <= r.peakY || r.vy > -2.2){
          explodeHeart(r.x, r.y, r.hue);
          rockets.splice(i,1);
        }
        if(r.y > H + 80) rockets.splice(i,1);
      }

      // sparks
      for(let i=sparks.length-1;i>=0;i--){
        const s = sparks[i];
        s.x += s.vx;
        s.y += s.vy;
        s.vy += s.g;
        s.vx *= 0.985;
        s.vy *= 0.985;
        s.life -= 1;

        const alpha = Math.max(0, Math.min(1, s.life / 80));
        const flick = 0.75 + Math.sin((80 - s.life) * s.tw) * 0.25;

        ctx.fillStyle = hsl(s.hue, 100, 70, alpha * flick);
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.size, 0, Math.PI*2);
        ctx.fill();

        if(s.life <= 0 || s.y > H + 40) sparks.splice(i,1);
      }
    }

    // init canvas clean
    ctx.clearRect(0,0,W,H);

    // init gate button state
    setGateButtonState();
  </script>
</body>
</html>

